<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#333" />
<title>mininxd - Terabox Downloader</title>

<link rel="stylesheet" href="./css/style.css">
<script type="module" src="./js/script.js" 
        document.getElementById('fetchButton').addEventListener('click', async () => {
            const urlInput = document.getElementById('urlInput').value;
            if (!urlInput) {
                alert('Please enter a URL.');
                return;
            }

            try {
                const response = await fetch(`https://boxstream.thejuniortest.workers.dev/?url=${encodeURIComponent(urlInput)}`);
                const data = await response.json();

                if (data.ok && data.downloadLink) {
                    const videoContainer = document.getElementById('videoContainer');
                    const videoPlayer = document.getElementById('videoPlayer');
                    const playButton = document.getElementById('playButton');
                    const downloadButton = document.getElementById('downloadButton');

                    videoPlayer.src = data.downloadLink;
                    videoContainer.style.display = 'none'; // Keep the video container hidden until "Play" is clicked
            
                    // Get the video's metadata to adjust container size
                    videoPlayer.onloadedmetadata = function() {
                        const aspectRatio = videoPlayer.videoWidth / videoPlayer.videoHeight;
                        const maxWidth = window.innerWidth * 0.9; // Set a maximum width for the container
                        const maxHeight = window.innerHeight * 0.8; // Set a maximum height for the container

                        let width = maxWidth;
                        let height = maxWidth / aspectRatio;

                        // Check if the calculated height exceeds the maximum height
                        if (height > maxHeight) {
                            height = maxHeight;
                            width = maxHeight * aspectRatio;
                        }

                        // Apply the calculated width and height to the video container
                        videoContainer.style.width = `${width}px`;
                        videoContainer.style.height = `${height}px`;
                    };

                    playButton.style.display = 'inline'; // Show the "Play" button
                    downloadButton.style.display = 'inline'; // Show the "Download" button
                } else {
                    alert('Failed to fetch video link.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error fetching video link.');
            }
        });

        document.getElementById('playButton').addEventListener('click', () => {
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.style.display = 'block'; // Show the video container
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.load();
            videoPlayer.play();
        });        

        document.getElementById('downloadButton').addEventListener('click', () => {
            const videoPlayer = document.getElementById('videoPlayer');
            window.open(videoPlayer.src, '_blank'); // Open the video URL in a new tab to start the download
        });
    </script>
  </head>
  
<body>
<div class="container">

<center>
  <div class="content is-normal">
  <img src="https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHM0OYfiFeMI2p9MWie0CvL99U4GA1gf6_kayTt_kBblFwHwo8BW8JXlqfnYxKPmmBavZ3kw9ja.DSKEM3oHma_Yp_x3MQ1_IbkBOThLBQLY8ddu3wRMBd2op5k7nrOIgg64t7TDg07cd.p3G0AwnkZA-&format=source&h=464" width="128">
  <h1>Terabox Downloader</h1>
  </div>
  </center>

<div class="fleksibel">
  <br>
<input id="inputEl" placeholder="https://terabox.com/s/..." class="input is-rounded is-normal is-dark">
<button id="fetchLink" class="button is-rounded is-dark">GO</button>
</div>
</div>

<div class="container is-fluid">
<div id="serverCheckEl" style="font-size:12px" class="is-small">
    <progress style="width:80%; height:4px" class='progress is-info is-light is-small' max="100"></progress>
    Server Checking...
  </div>
  <span id="statOK" style="display:none; width:fit-content" class="tag tags is-success is-light">
    Server is up! 
    <button id="delStat" class="delete is-small"></button>
    </span>
  <span id="statFail" style="display:none; width:fit-content" class="tag tags is-danger is-light">
    <span id="failText">
    Server is down! 
    </span>
    <button id="delStatt" class="delete is-small"></button>
    </span>
    <br>
</div>


  <div id="loadingEl" style="display:none" class="container is-fluid">
    <p>Processing your link</p>
  <progress id="prog" class="progress is-dark is-small"  max="100"></progress>
  </div>
  <br>
<div class="container is-fluid">
  <div id="errorMsg" class="notification" style="display:none">
  <button id="hideError" class="delete"></button>
  <span id="errorText"></span>
  </div>



<div id="downloadBtn" style="display:none">
  <div class="buttons is-centered">
  <button id="copyLinkEl" class="button is-dark is-rounded">
    Copy Link
    </button>
    <a id="downloadLinkEl">
  <button class="button is-dark is-rounded">
    Download
  </button>
  </a>
  </div>
  
<div class="control">
  <p>Direct download link :</p>
  <textarea id="linkTextEl" class="textarea"></textarea>
  </div>
</div>


</div>


<div id="footer" class="kaki">
<a class="donate" href="https://saweria.co/mininxd">Donate Saweria</a><br>
  mininxd 2024 - Present
</div>
</body>
  </html>
